---
username_file_path: /Users/jdickman/Git/refactored-couscous/usernames.yml
mop_repo: '/Users/jdickman/Git/1 - Docs/MOPs/YAML/'

page_title: svl-agg10 Peer-Group
parent_page_id: 8885131
ticket: NOC-649217

summary:
- Create new peer-group for VPN address-families
- Add chained-composite-next-hop
level: 3
exec: NOC
rh: LA2
approval: COR-1234
impact:
- All BGP peerings on svl-agg10
- Similar notice as NOC-635677
escalation: Deploying Engineer

p_rollback: Yes
rollback:
 - |-
  

pm:
- |-
  svl-agg10:
    show bgp summary

tech_equip:
  - Light meter
  - labeler
shipping:
  NOC-123456:
    - Fedex
    - Inbound
  NOC-789123:
    - Fedex
    - Inbound

sections:
  'VPN BGP Group Creation':
    - cmd-noc:
      - Retrieve the authentication-key from the existing peer-group
      - |-
        svl-agg10:
          show configuration protocols bgp group infrarr-v4 authentication-key
          request chassis decrypt {{ AUTH_KEY }}
    - cmd-noc:
      - Configure svl-agg10 as follows
      - |-
        routing-options {
          route-distinguisher-id 137.164.16.16;
          protect core;
          forwarding-table {
            chained-composite-next-hop {
              ingress {
                evpn;
                l3vpn extended-space;
              }
            }
          }
        }
        protocols {
          bgp {
            group infrarr-svl-agg10-v4 {
              type internal;
              local-address 137.164.16.16;
              rfc6514-compliant-safi129;
              import bgp-import-infrarr;
              family inet {
                  unicast;
                  multicast;
              }
              family inet-vpn {
                  unicast;
                  multicast;
              }
              family inet6-vpn {
                  unicast;
                  multicast;
              }
              family evpn {
                  signaling;
              }
              family inet-mvpn {
                  signaling;
              }
              family inet6-mvpn {
                  signaling;
              }
              family route-target;
              authentication-key {{ PLAINTEXT AUTH_KEY }};
              export [ bgp-export-edge bgp-export-aggregate ];
              cluster 137.164.16.16;
              peer-as 2152;
              neighbor 137.164.39.255 {
                  passive;
              }
            }
            group infrarr-svl-agg10-v6 {
              type internal;
              local-address 2607:f380::118:9a41:101;
              import bgp-import-infrarr;
              family inet6 {
                  unicast;
                  multicast;
              }
              authentication-key {{ PLAINTEXT AUTH_KEY }};
              export [ bgp-export-edge bgp-export-aggregate ];
              cluster 137.164.16.16;
              peer-as 2152;
            }
          }
        }
    - noc: After committing, this will reset BGP sessions on svl-agg10. Verify that all peerings restore.