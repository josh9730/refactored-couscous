---
username_file_path: /Users/jdickman/Git/refactored-couscous/usernames.yml
mop_repo: '/Users/jdickman/Git/1 - Docs/MOPs/YAML/'

page_title: MX204 Upgrades - 19.4R3-S2.2
parent_page_id: 9662071
ticket: NOC-657177

summary:
- Upgrade MX204 CPEs to 19.4R3-S2.2
level: 2
exec: NOC
rh: 
approval:
impact:
- Reload of each CPE, impact will vary
escalation: Deploying Engineer

p_rollback: Yes
rollback:
 - |-
  If rollback is needed after the reboot:
    request vmhost software rollback 
      - You should see a message 'Rollback complete, please reboot the node for it to take effect'
    request vmhost reboot

pm:
- |-
  CODE UPLOAD

  For each CPE, upload the new code to the device:
    1. scp {{ INSTALLATION PACKAGE }} {{ MFA USER }}@{{ DEVICE }}:/var/tmp/
    2. Verify MD5 Checksum (see Notes section above for Checksum):
       file checksum md5 /var/tmp/{{ INSTALLATION PACKAGE }}

    NOTE: Alternatively, the file can be downloaded from Juniper's website straight to the router. If you have a Juniper account this may be faster than the way above.

  SNAPSHOTS

  {{ device }}:
    verify OOB access if available
    show bgp summary
    show isis adjacency
    show interface {{ }}
    show chassis routing-engine
    show chassis environment
    show system alarms
    show chassis fpc pic-status
    show configuration | match ether-options | display set
      - Note any interfaces have 'ether-options' instead of 'gigether-options' as this will need to be upgdated

tech_equip:
  -
shipping:

sections:
  'Update Config':
    - cmd-noc:
      - As determined in Pre-Maintenance, 'ether-options' needs to be updated to 'gigether-options'
      - |-
        show configuration {{ INTERFACE }}

        set interface {{ INTERFACE }} gigether-options 802.3ad {{ AE# }}
  'Install Software':
    - cmd-noc:
      - Take snapshots
      - |-
        request system snapshot
        request system snapshot recovery
        request vmhost snapshot
    - cmd-noc:
      - Install, can take ~15 minutes
      - |-
        request vmhost software add /var/tmp/{{ INSTALLATION PACKAGE }}
    - cmd-noc:
      - Issue upgrade command. This will cause a reload, and impact services
      - |-
        request vmhost reboot
    - cmd-noc:
      - Verify the upgrade
      - |-
        show vmhost version
        show version
    - noc: Verify pre-/post-maintenance captures. If all services have restored, issue {{request vmhost snapshot}}.