
{code:title=LAX-AGG10|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

chassis {
    network-services enhanced-ip;
}
interfaces {
    ae11.2302 {
        family mpls {
            maximum-labels 16;
        }
    }
    ae22.2306 {
        family mpls {
            maximum-labels 16;
        }
    }
    et-7/0/3.0 {
        family mpls {
            maximum-labels 16;
        }
    }
}
policy-options {
    policy-statement bgp-import-locpref {
        term t01 {
            from community 2152:90;
            then {
                local-preference 90;
            }
        }
        term t02 {
            from community 2152:80;
            then {
                local-preference 80;
            }
        }
        term t03 {
            from community 2152:70;
            then {
                local-preference 70;
            }
        }
    }
    policy-statement label-hybrid {
        term t01 {
            from protocol direct;
            then {
                label-allocation per-table;
                accept;
            }
        }
        term t02 {
            then {
                label-allocation per-nexthop;
                accept;
            }
        }
    }
    policy-statement reject-all {
        term t01 {
            then reject;
        }
    }
    community 2152:90 members 2152:90;
    community 2152:80 members 2152:80;
    community 2152:70 members 2152:70;
}
routing-options {
    route-distinguisher-id 137.164.16.6;
}
protocols {
    isis {
        interface ae11.2302 {
            level 2 {
                post-convergence-lfa {
                    node-protection;
                }
            }
        }
        interface ae22.2306 {
            level 2 {
                post-convergence-lfa {
                    node-protection;
                }
            }
        }
        interface et-7/0/3.0 {
            level 2 {
                post-convergence-lfa {
                    node-protection;
                }
            }
        }
        source-packet-routing {
            srgb start-label 16000 index-range 8000;
            node-segment {
                ipv4-index 0;
                ipv6-index 1;
            }
            explicit-null;
        }
        backup-spf-options {
            use-post-convergence-lfa;
        }
    }
    ldp {
        export reject-all;
        interface ae11.2302;
        interface ae22.2306;
        interface et-7/0/3.0;
        p2mp;
    }
    mpls {
        icmp-tunneling;
        ipv6-tunneling;
        interface ae11.2302;
        interface ae22.2306;
        interface et-7/0/3.0;
    }
}

--- VERIFICATION

show isis overview | match "SRGB|Source|Index|Conv|Level"
show mpls label usage | match "Ranges|SRGB"
show mpls interface detail | match "Int|State|Max"
show isis database lax-agg10 detail | match "Index|Seg"


{code}
{code:title=RIV-AGG8|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface be30.2315
 !
 interface be22.2306
 !
 interface be26.2311
 !
 interface be2
 !
 interface te0/0/0/1/0
 !
 interface te0/1/0/1/2
 !
 interface be24.2308
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 2 explicit-null
  address-family ipv6 unicast
   prefix-sid index 3 explicit-null
 !
 interface be30.2315
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be22.2306
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be26.2311
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be2
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface te0/0/0/1/0
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface te0/1/0/1/2
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be24.2308
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces be30.2315 detail
show mpls interfaces be22.2306 detail
show mpls interfaces be26.2311 detail
show mpls interfaces be2 detail
show mpls interfaces te0/0/0/1/0 detail
show mpls interfaces te0/1/0/1/2 detail
show mpls interfaces be24.2308 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose riv-agg8 | in "Index|Segment"

{code}
{code:title=LAX-AGG8|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface be11.2302
 !
 interface be20.2304
 !
 interface hu0/0/0/3
 !
 interface hu0/1/0/3
 !
 interface hu0/1/0/21
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 8 explicit-null
  address-family ipv6 unicast
   prefix-sid index 9 explicit-null
 !
 interface be11.2302
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be20.2304
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface hu0/0/0/3
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface hu0/1/0/3
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface hu0/1/0/21
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces be11.2302 detail
show mpls interfaces be20.2304 detail
show mpls interfaces hu0/0/0/3 detail
show mpls interfaces hu0/1/0/3 detail
show mpls interfaces hu0/1/0/21 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose lax-agg8 | in "Index|Segment"

{code}
{code:title=SVL-AGG8|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface hu0/0/0/3
 !
 interface hu0/1/0/3
 !
 interface hu0/1/0/23
 !
 interface be25.2309
 !
 interface be31.2303
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 6 explicit-null
  address-family ipv6 unicast
   prefix-sid index 7 explicit-null
 !
 interface hu0/0/0/3
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface hu0/1/0/3
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface hu0/1/0/23
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be25.2309
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be31.2303
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces hu0/0/0/3 detail
show mpls interfaces hu0/1/0/3 detail
show mpls interfaces hu0/1/0/23 detail
show mpls interfaces be25.2309 detail
show mpls interfaces be31.2303 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose svl-agg8 | in "Index|Segment"

{code}
{code:title=SVL-AGG10|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

chassis {
    network-services enhanced-ip;
}
interfaces {
    ae23.2303 {
        family mpls;
    }
    ae32.2310 {
        family mpls;
    }
    xe-0/1/2:2.0 {
        family mpls;
    }
    xe-0/1/2:3.0 {
        family mpls;
    }
}
policy-options {
    policy-statement bgp-import-locpref {
        term t01 {
            from community 2152:90;
            then {
                local-preference 90;
            }
        }
        term t02 {
            from community 2152:80;
            then {
                local-preference 80;
            }
        }
        term t03 {
            from community 2152:70;
            then {
                local-preference 70;
            }
        }
    }
    policy-statement label-hybrid {
        term t01 {
            from protocol direct;
            then {
                label-allocation per-table;
                accept;
            }
        }
        term t02 {
            then {
                label-allocation per-nexthop;
                accept;
            }
        }
    }
    policy-statement reject-all {
        term t01 {
            then reject;
        }
    }
    community 2152:90 members 2152:90;
    community 2152:80 members 2152:80;
    community 2152:70 members 2152:70;
}
routing-options {
    route-distinguisher-id 137.164.16.16;
}
protocols {
    isis {
        source-packet-routing {
            srgb start-label 16000 index-range 8000;
            node-segment {
                ipv4-index 4;
                ipv6-index 5;
            }
            explicit-null;
        }
    }
    ldp {
        export reject-all;
        interface ae23.2303;
        interface ae32.2310;
        interface xe-0/1/2:2.0;
        interface xe-0/1/2:3.0;
        p2mp;
    }
    mpls {
        icmp-tunneling;
        ipv6-tunneling;
        interface ae23.2303;
        interface ae32.2310;
        interface xe-0/1/2:2.0;
        interface xe-0/1/2:3.0;
    }
}

--- VERIFICATION

show isis overview | match "SRGB|Source|Index|Conv|Level"
show mpls label usage | match "Ranges|SRGB"
show mpls interface detail | match "Int|State|Max"
show isis database svl-agg10 detail | match "Index|Seg"


{code}
{code:title=TUS-AGG8|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface be20.2304
 !
 interface be21.2305
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 10 explicit-null
  address-family ipv6 unicast
   prefix-sid index 11 explicit-null
 !
 interface be20.2304
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be21.2305
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces be20.2304 detail
show mpls interfaces be21.2305 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose tus-agg8 | in "Index|Segment"

{code}
{code:title=SDG-AGG4|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface be21.2305
 !
 interface be26.2311
 !
 interface Hu0/5/0/0
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 12 explicit-null
  address-family ipv6 unicast
   prefix-sid index 13 explicit-null
 !
 interface be21.2305
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be26.2311
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface Hu0/5/0/0
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces be21.2305 detail
show mpls interfaces be26.2311 detail
show mpls interfaces Hu0/5/0/0 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose sdg-agg4 | in "Index|Segment"

{code}
{code:title=OAK-AGG8|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface te0/0/0/17/2
 !
 interface be23.2307
 !
 interface be27.2312
 !
 interface be32.2310
 !
 interface Hu0/1/0/5
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 14 explicit-null
  address-family ipv6 unicast
   prefix-sid index 15 explicit-null
 !
 interface te0/0/0/17/2
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be23.2307
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be27.2312
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be32.2310
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface Hu0/1/0/5
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces te0/0/0/17/2 detail
show mpls interfaces be23.2307 detail
show mpls interfaces be27.2312 detail
show mpls interfaces be32.2310 detail
show mpls interfaces Hu0/1/0/5 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose oak-agg8 | in "Index|Segment"

{code}
{code:title=SFO-AGG4|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface be25.2309
 !
 interface hu0/4/0/1
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 16 explicit-null
  address-family ipv6 unicast
   prefix-sid index 17 explicit-null
 !
 interface be25.2309
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface hu0/4/0/1
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces be25.2309 detail
show mpls interfaces hu0/4/0/1 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose sfo-agg4 | in "Index|Segment"

{code}
{code:title=SLO-AGG4|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface hu0/0/0/0
 !
 interface te0/2/0/0
 !
 interface te0/2/0/1
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 18 explicit-null
  address-family ipv6 unicast
   prefix-sid index 19 explicit-null
 !
 interface hu0/0/0/0
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface te0/2/0/0
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface te0/2/0/1
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces hu0/0/0/0 detail
show mpls interfaces te0/2/0/0 detail
show mpls interfaces te0/2/0/1 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose slo-agg4 | in "Index|Segment"

{code}
{code:title=SOL-AGG4|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

chassis {
    network-services enhanced-ip;
}
interfaces {
    xe-1/0/0:0.0 {
        family mpls;
    }
    xe-1/0/0:1.0 {
        family mpls;
    }
    xe-2/0/0:0.0 {
        family mpls;
    }
    xe-2/0/0:2.0 {
        family mpls;
    }
}
policy-options {
    policy-statement bgp-import-locpref {
        term t01 {
            from community 2152:90;
            then {
                local-preference 90;
            }
        }
        term t02 {
            from community 2152:80;
            then {
                local-preference 80;
            }
        }
        term t03 {
            from community 2152:70;
            then {
                local-preference 70;
            }
        }
    }
    policy-statement label-hybrid {
        term t01 {
            from protocol direct;
            then {
                label-allocation per-table;
                accept;
            }
        }
        term t02 {
            then {
                label-allocation per-nexthop;
                accept;
            }
        }
    }
    policy-statement reject-all {
        term t01 {
            then reject;
        }
    }
    community 2152:90 members 2152:90;
    community 2152:80 members 2152:80;
    community 2152:70 members 2152:70;
}
routing-options {
    route-distinguisher-id 137.164.16.85;
}
protocols {
    isis {
        source-packet-routing {
            srgb start-label 16000 index-range 8000;
            node-segment {
                ipv4-index 20;
                ipv6-index 21;
            }
            explicit-null;
        }
    }
    ldp {
        export reject-all;
        interface xe-1/0/0:0.0;
        interface xe-1/0/0:1.0;
        interface xe-2/0/0:0.0;
        interface xe-2/0/0:2.0;
        p2mp;
    }
    mpls {
        icmp-tunneling;
        ipv6-tunneling;
        interface xe-1/0/0:0.0;
        interface xe-1/0/0:1.0;
        interface xe-2/0/0:0.0;
        interface xe-2/0/0:2.0;
    }
}

--- VERIFICATION

show isis overview | match "SRGB|Source|Index|Conv|Level"
show mpls label usage | match "Ranges|SRGB"
show mpls interface detail | match "Int|State|Max"
show isis database sol-agg4 detail | match "Index|Seg"


{code}
{code:title=PDC-AGG1|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

chassis {
    network-services enhanced-ip;
}
interfaces {
    et-1/0/2.0 {
        family mpls;
    }
    ae50.0 {
        family mpls;
    }
}
policy-options {
    policy-statement bgp-import-locpref {
        term t01 {
            from community 2152:90;
            then {
                local-preference 90;
            }
        }
        term t02 {
            from community 2152:80;
            then {
                local-preference 80;
            }
        }
        term t03 {
            from community 2152:70;
            then {
                local-preference 70;
            }
        }
    }
    policy-statement label-hybrid {
        term t01 {
            from protocol direct;
            then {
                label-allocation per-table;
                accept;
            }
        }
        term t02 {
            then {
                label-allocation per-nexthop;
                accept;
            }
        }
    }
    policy-statement reject-all {
        term t01 {
            then reject;
        }
    }
    community 2152:90 members 2152:90;
    community 2152:80 members 2152:80;
    community 2152:70 members 2152:70;
}
routing-options {
    route-distinguisher-id 137.164.16.32;
}
protocols {
    isis {
        source-packet-routing {
            srgb start-label 16000 index-range 8000;
            node-segment {
                ipv4-index 22;
                ipv6-index 23;
            }
            explicit-null;
        }
    }
    ldp {
        export reject-all;
        interface et-1/0/2.0;
        interface ae50.0;
        p2mp;
    }
    mpls {
        icmp-tunneling;
        ipv6-tunneling;
        interface et-1/0/2.0;
        interface ae50.0;
    }
}

--- VERIFICATION

show isis overview | match "SRGB|Source|Index|Conv|Level"
show mpls label usage | match "Ranges|SRGB"
show mpls interface detail | match "Int|State|Max"
show isis database pdc-agg1 detail | match "Index|Seg"


{code}
{code:title=BAK-AGG6|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

chassis {
    network-services enhanced-ip;
}
interfaces {
    ae33.2317 {
        family mpls;
    }
    xe-1/0/5:0.0 {
        family mpls;
    }
    xe-1/0/5:1.0 {
        family mpls;
    }
}
policy-options {
    policy-statement bgp-import-locpref {
        term t01 {
            from community 2152:90;
            then {
                local-preference 90;
            }
        }
        term t02 {
            from community 2152:80;
            then {
                local-preference 80;
            }
        }
        term t03 {
            from community 2152:70;
            then {
                local-preference 70;
            }
        }
    }
    policy-statement label-hybrid {
        term t01 {
            from protocol direct;
            then {
                label-allocation per-table;
                accept;
            }
        }
        term t02 {
            then {
                label-allocation per-nexthop;
                accept;
            }
        }
    }
    policy-statement reject-all {
        term t01 {
            then reject;
        }
    }
    community 2152:90 members 2152:90;
    community 2152:80 members 2152:80;
    community 2152:70 members 2152:70;
}
routing-options {
    route-distinguisher-id 137.164.16.34;
}
protocols {
    isis {
        source-packet-routing {
            srgb start-label 16000 index-range 8000;
            node-segment {
                ipv4-index 24;
                ipv6-index 25;
            }
            explicit-null;
        }
    }
    ldp {
        export reject-all;
        interface ae33.2317;
        interface xe-1/0/5:0.0;
        interface xe-1/0/5:1.0;
        p2mp;
    }
    mpls {
        icmp-tunneling;
        ipv6-tunneling;
        interface ae33.2317;
        interface xe-1/0/5:0.0;
        interface xe-1/0/5:1.0;
    }
}

--- VERIFICATION

show isis overview | match "SRGB|Source|Index|Conv|Level"
show mpls label usage | match "Ranges|SRGB"
show mpls interface detail | match "Int|State|Max"
show isis database bak-agg6 detail | match "Index|Seg"


{code}
{code:title=FRE-AGG4|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface be33.2317
 !
 interface be29.2314
 !
 interface be30.2315
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 26 explicit-null
  address-family ipv6 unicast
   prefix-sid index 27 explicit-null
 !
 interface be33.2317
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be29.2314
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be30.2315
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces be33.2317 detail
show mpls interfaces be29.2314 detail
show mpls interfaces be30.2315 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose fre-agg4 | in "Index|Segment"

{code}
{code:title=FRG-AGG4|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface be28.2313
 !
 interface be29.2314
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 28 explicit-null
  address-family ipv6 unicast
   prefix-sid index 29 explicit-null
 !
 interface be28.2313
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be29.2314
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces be28.2313 detail
show mpls interfaces be29.2314 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose frg-agg4 | in "Index|Segment"

{code}
{code:title=SAC-AGG4|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface be27.2312
 !
 interface be31.2316
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 30 explicit-null
  address-family ipv6 unicast
   prefix-sid index 31 explicit-null
 !
 interface be27.2312
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be31.2316
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces be27.2312 detail
show mpls interfaces be31.2316 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose sac-agg4 | in "Index|Segment"

{code}
{code:title=COR-AGG8|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

chassis {
    network-services enhanced-ip;
}
interfaces {
    et-1/0/5.0 {
        family mpls;
    }
    xe-0/0/1:0.0 {
        family mpls;
    }
}
policy-options {
    policy-statement bgp-import-locpref {
        term t01 {
            from community 2152:90;
            then {
                local-preference 90;
            }
        }
        term t02 {
            from community 2152:80;
            then {
                local-preference 80;
            }
        }
        term t03 {
            from community 2152:70;
            then {
                local-preference 70;
            }
        }
    }
    policy-statement label-hybrid {
        term t01 {
            from protocol direct;
            then {
                label-allocation per-table;
                accept;
            }
        }
        term t02 {
            then {
                label-allocation per-nexthop;
                accept;
            }
        }
    }
    policy-statement reject-all {
        term t01 {
            then reject;
        }
    }
    community 2152:90 members 2152:90;
    community 2152:80 members 2152:80;
    community 2152:70 members 2152:70;
}
routing-options {
    route-distinguisher-id 137.164.16.37;
}
protocols {
    isis {
        source-packet-routing {
            srgb start-label 16000 index-range 8000;
            node-segment {
                ipv4-index 32;
                ipv6-index 33;
            }
            explicit-null;
        }
    }
    ldp {
        export reject-all;
        interface et-1/0/5.0;
        interface xe-0/0/1:0.0;
        p2mp;
    }
    mpls {
        icmp-tunneling;
        ipv6-tunneling;
        interface et-1/0/5.0;
        interface xe-0/0/1:0.0;
    }
}

--- VERIFICATION

show isis overview | match "SRGB|Source|Index|Conv|Level"
show mpls label usage | match "Ranges|SRGB"
show mpls interface detail | match "Int|State|Max"
show isis database cor-agg8 detail | match "Index|Seg"


{code}
{code:title=TRI-AGG2|linenumbers=true|language=text|collapse=true}

--- LOAD MERGE

ipv4 access-list deny-all
 10 deny ipv4 any any
!
route-policy pass-all
  pass
end-policy
!
route-policy bgp-import-ipvpn
  apply bgp-import-locpref
  pass
end-policy
!
route-policy rpf-mldp-default
  set core-tree mldp-default
end-policy
!
route-policy bgp-import-locpref
  if community matches-any (2152:90) then
    set local-preference 90
  endif
  if community matches-any (2152:80) then
    set local-preference 80
  endif
  if community matches-any (2152:70) then
    set local-preference 70
  endif
end-policy
!
mpls traffic-eng
!
mpls ldp
 mldp
  address-family ipv4
  !
 !
 address-family ipv4
  label
   local
    allocate for deny-all
   !
  !
 !
 interface hu0/2/0/3
 !
 interface be23.2307
 !
 interface be24.2308
 !
 interface be28.2313
 !
 interface be31.2316
 !
!
router isis 2152
 address-family ipv4 unicast
  mpls traffic-eng router-id Loopback0
  segment-routing mpls
 address-family ipv6 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid index 34 explicit-null
  address-family ipv6 unicast
   prefix-sid index 35 explicit-null
 !
 interface hu0/2/0/3
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be23.2307
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be24.2308
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be28.2313
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 interface be31.2316
  address-family ipv4 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
  address-family ipv6 unicast
   fast-reroute per-prefix
   fast-reroute per-prefix ti-lfa
  !
 !
!

--- VERIFICATION

show mpls interfaces hu0/2/0/3 detail
show mpls interfaces be23.2307 detail
show mpls interfaces be24.2308 detail
show mpls interfaces be28.2313 detail
show mpls interfaces be31.2316 detail
show isis instance 2152 protocol | in SRGB
show isis instance 2152 segment-routing label table
show isis instance 2152 database verbose tri-agg2 | in "Index|Segment"

{code}